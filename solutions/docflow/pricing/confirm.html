<!DOCTYPE html>
<!-- copyright 2019 Intwixt, Inc. All rights reserved. -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Intwixt Docflow | Order Confirmation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Run Box.com approval flows in Slack"/>
    <meta name="keywords" content="Box.com, document workflow, approval flows, Slack"/>
    <meta name="author" content="contact@intwixt.com"/>

    <!-- Bootstrap  -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <!-- Owl Carousel  -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.default.min.css">
    <!-- Animate.css -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- Orbit.css -->
    <link rel="stylesheet" href="/css/orbit.css">
    <!-- Fonts -->
    <link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Lato:100,300' rel='stylesheet' type='text/css'>
    <!-- Theme style  -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- Slack Emulator styles  -->
    <link rel="stylesheet" href="/emulator/css/slack.css">

    <!-- Analytics -->
    <script>(function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o), m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-72994520-1', 'auto');
    ga('send', 'pageview');</script>
    <script>ga('create', 'UA-72994520-1', 'auto', {'name': 'custom'});</script>
</head>
<body id="home">

<div id="page-wrap">


    <!-- ==========================================================================================================
                                                       HERO
         ========================================================================================================== -->

    <div id="fh5co-hero-wrapper" style="height:auto;margin-bottom:100px;">
        <nav class="navbar navbar-expand-lg main-navbar-nav navbar-dark fixed-top">
            <a class="navbar-brand" href="/">Intwixt</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav nav-items-right ml-auto mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/solutions/docflow">DocFlow</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/solutions/docflow#faq">FAQ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/solutions/docflow/pricing">
                            Pricing
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </div> <!-- first section wrapper -->


    <!-- ==========================================================================================================
                                 PRICING / ORDERING
         ========================================================================================================== -->

    <div id="solutions" class="examples-outer">
        <div class="container solution plans docflow">

            <img src="/img/docflow.png" align="left" class="logo">

            <h1 class="title">DocFlow Order Confirmation</h1>

            <p>
                Thanks, <b id="slack_user_name">Sandy</b>! Your order was successfully processed.
            </p>
            <div style="clear: both;">
                <p>Here are your subscription details. Your card will be charged at the start of the next <b id="cycle_adjective">annual</b> billing cycle.
                    If you need to make any changes to your subscription, including adding/removing submitters or
                    updating
                    your credit card details, enter the slash command, <code>/docflow billing</code>.</p>
                <table class="order-details" style="table-layout: fixed;width:200px;border-color:transparent;" cellpadding="8">
                    <tr>
                        <td style="width:140px;">Plan</td>
                        <td><b id="plan">Standard</b></td>
                    </tr>
                    <tr>
                        <td>Cycle</td>
                        <td><b id="cycle_noun">Annual</b></td>
                    </tr>
                    <tr>
                        <td>Submitters (qty)</td>
                        <td><b id="quantity">31</b></td>
                    </tr>
                    <tr>
                        <td>Amount</td>
                        <td><b id="amount">$1,450.00</b></td>
                    </tr>
                </table>
                <p></p>
            </div>
        </div>


    </div> <!-- end example -->


    <!-- ==========================================================================================================
                                                 CALL TO ACTION
    ========================================================================================================== -->

    <div id="contact" class="fh5co-bottom-outer">
        <div class="overlay">
            <div class="container fh5co-bottom-inner">
                <div class="row">
                    <div class="col-12 col-sm-6 col-md-7 call-to-action">
                        <h1>Want to learn more?</h1>
                        <p>Run conversational business processes backed by our AI-enabled process engine.</p>
                        <div class="links">
                            <div>
                                <i class="far fa-envelope"></i> <a
                                    href="mailto:contact@intwixt.com">contact@intwixt.com</a>
                            </div>
                            <div>
                                <i class="fas fa-phone"></i> <a href="tel:650-209-4216">650-209-4216</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-md-5">
                        <div class="benefits">
                            <div class="rotate anim1">
                                <div class="counterrotate">
                                    <div class="inner">
                                        <img class="icon-filter-white" src="/img/benefits/efficiency.png"
                                             alt="Efficient">
                                        <div>Efficiency</div>
                                    </div>
                                </div>
                            </div>
                            <div class="rotate anim2">
                                <div class="counterrotate">
                                    <div class="inner">
                                        <img class="icon-filter-white" src="/img/benefits/transparency.png"
                                             alt="Transparent">
                                        <div>Transparency</div>
                                    </div>
                                </div>
                            </div>
                            <div class="rotate anim3">
                                <div class="counterrotate">
                                    <div class="inner">
                                        <img class="icon-filter-white" src="/img/benefits/usability.png"
                                             alt="Usable">
                                        <div>Usability</div>
                                    </div>
                                </div>
                            </div>
                            <div class="rotate anim4">
                                <div class="counterrotate">
                                    <div class="inner">
                                        <img class="icon-filter-white" src="/img/benefits/extensibility.png"
                                             alt="Extensible">
                                        <div>Extensibility</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ==========================================================================================================
                                               SECTION 7 - SUB FOOTER
    ========================================================================================================== -->

    <footer class="footer-outer">
        <div class="container footer-inner">

            <span class="border-bottom-footer"></span>

            <div>
                <nav class="footer-nav">
                    <ul class="nav-items secondary-nav wow fadeIn animated" data-wow-delay="0.66s">
                        <a href="/privacy">
                            <li>Privacy Policy</li>
                        </a>
                        <a href="/terms">
                            <li>Terms and Conditions</li>
                        </a>
                    </ul>
                </nav>
            </div>

            <p class="copyright">&copy; 2019 Intwixt, Inc. All rights reserved.</p>

        </div>
    </footer>

</div> <!-- main page wrapper end content -->

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/wow.min.js"></script>
<script src="/js/main.js"></script>
<script src="https://js.stripe.com/v3/"></script>
<script>
  //set the public key needed for submitting the order to Stripe
  var stripe = Stripe('pk_test_dRxwVniwE4hEH3AYZgBROyp6');

  //price calculator
  var qty = $("#quantity");
  var ann = $("#annually");
  var quantity, is_annual;


  /**
   *
   */
  function calculate() {
    var unit_price = 5;
    var annual_discount_rate = .8;
    quantity = qty.val();
    if (isNaN(quantity)) {
      quantity = 1;
      qty.val(quantity);
    }
    is_annual = ann.is(':checked');
    var amount = is_annual ? (unit_price * annual_discount_rate * quantity * 12) : unit_price * quantity;
    $("#total").html("Total: $" + amount.toLocaleString('en') + ".00" + (is_annual ? " / Year" : " / Month"));
  }

  qty.on("change keyup paste", function () {
    calculate();
  });
  ann.change(function () {
    calculate();
  });


  // the pricing page is typically opened from Slack, and includes encoded profile information about the user's identity
  // (if not present, check the cookie for a cached instance)
  var slack_profile, session_profile, is_redirect;
  if (window.location.hash) {
    is_redirect = true;
    slack_profile = window.decodeURIComponent(window.location.hash.substr(1));
    window.location.hash = "";
    var noHashURL = window.location.href.replace(/#.*$/, '');
    window.history.replaceState('', document.title, noHashURL);
  } else {
    slack_profile = getCookie("slack_profile");
  }
  console.log(slack_profile);
  if (slack_profile && slack_profile.indexOf("{") === 0) {
    setCookie("slack_profile", slack_profile, 365);
    session_profile = JSON.parse(slack_profile);
    is_redirect = is_redirect && session_profile && session_profile.quantity && session_profile.cycle;
  } else if (slack_profile) {
    eraseCookie("slack_profile");
  }
  if(is_redirect) {
    create_checkout_session(session_profile.quantity, session_profile.cycle === "annually", session_profile);
  } else {
    $("#submit").on("click", function () {
      create_checkout_session(quantity, is_annual, session_profile);
    });
  }



  /**
   * create the checkout session (make call to ixt process providing the user's slack identity)
   * @param quantity {number} number of seats (submitters)
   * @param is_annual {boolean} if cycle is boolean
   * @param profile {object|null} user Slack profile returned/cached during last login
   * @param [profile.user_id] {string}
   * @param [profile.team_id] {string}
   * @param [profile.session_id] {string}
   */
  function create_checkout_session(quantity, is_annual, profile) {
    var base_url;
    var cycle = is_annual ? "annually" : "monthly";
    if (!(profile && profile.user_id && profile.team_id && profile.session_id)) {
      // 1) resolve the user's Slack identity first, so we know how to link the payment to the proper account
      base_url = "https://intwixt-0.apis.intwixt.com/api/v1/slack/authorization/target";
      var qs = "?quantity=" + quantity + "&cycle=" + cycle;
      $.get(base_url + qs).done(function (data) {
        console.log("success!!");
        console.log(data);
        //begin the oauth flow; when it completes, the user will be redirected to this page, along with identity details
        window.location.href = data.url;
      }).fail(function (data) {
        console.log("fail!!");
        console.log(data);
        //note: should only occur if a server failure/system error (redirect never occurs without user authorization)
      });
    } else {
      // 2) generate the 'session_id' by providing the user's identity to the intwixt service
      base_url = "https://intwixt-0.apis.intwixt.com/api/v1/checkout_session";
      var data = {
        quantity: quantity,
        cycle: cycle,
        user_id: profile.user_id,
        team_id: profile.team_id,
        session_id: profile.session_id
      };
      $.post(base_url, data).done(function (data) {
        console.log("success!!");
        console.log(data);
        // 3) redirect to stripe, passing the session_id;
        // when the process completes successfully, stripe will alert a server-side webhook and redirect the user
        // to the confirmation page /solutions/docflow/pricing/confirm
        redirect_to_checkout(data.id)
      }).fail(function (data) {
        console.log("fail!!");
        console.log(data);
        //todo: need to alert user of the issue!
      });
    }
  }


  /**
   * final leg; redirect to Stripe now that we have a valid checkout session
   * @param session_id
   */
  function redirect_to_checkout(session_id) {
    stripe.redirectToCheckout({
      sessionId: session_id
    }).then(function (result) {
      console.log(result);
      console.log(result.error);
    });
  }


</script>
</body>
</html>
